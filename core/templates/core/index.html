{% extends "base.html" %}
{% load custom_filters %}

{% block title %}BOOKS{% endblock title %}

{% block body %}
    <h1>BOOKS</h1>
    {% for genre, books in books_by_genre.items%}
        <div>
            {% if books %}
            <h1>New in {{ genre }}</h1>
                {% for book in books %}
                    {% with book.volumeInfo as info %}
                    <div>
                        <h3>{{ info.title|titlecase }}</h3>
                        <a href="{% url 'book-detail' book.id %}">
                            {% if info.imageLinks and info.imageLinks.thumbnail %}
                                <img src="{{ info.imageLinks.thumbnail }}" alt="{{ info.title }}" />
                            {% endif %}
                        </a>
                        <p>Written By: {{ info.authors|join:", "|default:"Unknown" }}</p>
                        <p>First Published: {{ info.publishedDate|default:"N/A" }}</p>
                        
                        <p>
                            <span class="trunc-description-text" id="trunc-description-{{ book.id }}">
                                {{ info.truncated_description|default:"No description available"|safe }}
                            </span>
                            {% if info.description %}
                                <!-- Full description, hidden by default -->
                                <span class="description" id="description-{{ book.id }}" style="display:none;">
                                    {{ info.description|default:"No description available"|safe }}
                                </span>

                                <!-- The ellipsis will expand the description -->
                                <span class="expand-description" id="expand-{{ book.id }}">
                                    <a href="javascript:void(0);" onclick="expandDescription('{{ book.id }}')">[Read More]</a>
                                </span>
                            {% endif %}
                        </p>
                    </div>
                    {% endwith %}
                {% endfor %}
            {% endif %}
        {% empty %}
            <h1>No books Found</h1>
    {% endfor %}

{% endblock body %}

{% block add_js %}
    <script>
        function expandDescription(bookId) {
            var fullDesc = document.getElementById("description-" + bookId);
            var truncatedDesc = document.getElementById("trunc-description-" + bookId);
            var expandLink = document.getElementById("expand-" + bookId);
            
            // If the full description is currently hidden, show it
            if (fullDesc.style.display === "none") {
                fullDesc.style.display = "inline";  // Show full description
                truncatedDesc.style.display = "none";  // Hide truncated description
                expandLink.innerHTML = "<a href='javascript:void(0);' onclick='expandDescription(\"" + bookId + "\")'>[Read Less]</a>";  // Change to "Read less"
            } else {
                fullDesc.style.display = "none";  // Hide full description
                truncatedDesc.style.display = "inline";  // Show truncated description
                expandLink.innerHTML = "<a href='javascript:void(0);' onclick='expandDescription(\"" + bookId + "\")'>[Read More]</a>";  // Revert back to "Read more"
            }
        }
    </script>
{% endblock add_js %}
